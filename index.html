<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Gestión de Clientes</title>

    <!-- Bootstrap 5 -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet">

    <!-- Estilos personalizados -->
    <style>
        body {
            background: linear-gradient(to right, #b30000, #660000);
            min-height: 100vh;
        }

        .card {
            border-radius: 15px;
            border: none;
        }

        h1, h4, h5 {
            color: #8b0000 !important;
            text-shadow: 1px 1px 2px #ffffff70;
        }

        .btn-primary {
            background-color: #b30000;
            border: none;
        }

        .btn-primary:hover {
            background-color: #800000;
        }

        .btn-secondary {
            background-color: #333;
            border: none;
        }

        .btn-secondary:hover {
            background-color: #111;
        }

        .btn-outline-secondary:hover {
            background-color: #b30000;
            color: white;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #b30000;
        }

        .input-group .btn-primary {
            border-radius: 0 10px 10px 0;
        }

        .card {
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }

        #clientesList {
            padding: 10px;
            border-radius: 10px;
            background: #fff7f7;
            border: 1px solid #b30000;
        }
    </style>
</head>

<body>

    <div class="container py-4">

        <!-- TÍTULO PRINCIPAL -->
        <h1 class="text-center mb-4 fw-bold">Gestión de Clientes</h1>

        <!-- ========== FORMULARIO ========== -->
        <div class="row justify-content-center mb-4">
            <div class="col-md-8">
                <div class="card shadow-sm p-4">
                    <h4 class="text-center mb-3 fw-bold">Registrar / Editar Cliente</h4>

                    <form id="clienteForm" novalidate>
                        <input type="hidden" id="clienteId">

                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre*</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="nombre" 
                                placeholder="Ej: Juan Pérez">
                            <div class="text-danger small" id="nombreError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email*</label>
                            <input 
                                type="email" 
                                class="form-control" 
                                id="email" 
                                placeholder="ejemplo@dominio.com">
                            <div class="text-danger small" id="emailError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input 
                                type="tel" 
                                class="form-control" 
                                id="telefono" 
                                placeholder="Opcional - solo números (7-15 dígitos)">
                            <div class="text-danger small" id="telefonoError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="empresa" class="form-label">Empresa*</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="empresa" 
                                placeholder="Nombre de la empresa">
                            <div class="text-danger small" id="empresaError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="categoria" class="form-label">Categoría*</label>
                            <select id="categoria" class="form-select">
                                <option value="">-- Selecciona una categoría --</option>
                                <option value="basico">Básico</option>
                                <option value="premium">Premium</option>
                                <option value="vip">VIP</option>
                            </select>
                            <div class="text-danger small" id="categoriaError"></div>
                        </div>

                        <div class="d-flex gap-2">
                            <button 
                                type="submit" 
                                class="btn btn-primary w-50" 
                                id="guardarBtn">
                                Guardar Cliente
                            </button>

                            <button 
                                type="button" 
                                id="cancelarBtn" 
                                class="btn btn-secondary w-50">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========== BÚSQUEDA ========== -->
        <div class="row justify-content-center mb-4">
            <div class="col-md-8">
                <div class="card shadow-sm p-3">
                    <h5 class="text-center fw-bold mb-3">Buscar Clientes</h5>

                    <div class="input-group">
                        <input 
                            type="text" 
                            id="busqueda" 
                            class="form-control" 
                            placeholder="Buscar clientes...">

                        <button id="buscarBtn" class="btn btn-primary">Buscar</button>
                        <button id="limpiarBusquedaBtn" class="btn btn-outline-secondary">Limpiar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== LISTA DE CLIENTES ========== -->
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow-sm p-4">
                    <h4 class="text-center fw-bold mb-3">Lista de Clientes</h4>

                    <div id="clientesList"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
    </script>

    <script src="jss/app.js">
        
const STORAGE_KEY = "crm_clientes";

const getClientes = () =>
    JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

const saveClientes = (clientes) =>
    localStorage.setItem(STORAGE_KEY, JSON.stringify(clientes));

const guardarCliente = (cliente) => {
    const clientes = getClientes();

    if (cliente.id) {
        const i = clientes.findIndex(c => c.id === cliente.id);
        clientes[i] = cliente;
        alert("Cliente ACTUALIZADO correctamente");
    } else {
        cliente.id = Date.now().toString();
        clientes.push(cliente);
        alert("Cliente CREADO correctamente");
    }

    saveClientes(clientes);
};

const eliminarCliente = id => {
    saveClientes(getClientes().filter(c => c.id !== id));
    alert("Cliente ELIMINADO correctamente");
};


// =====================================
// VALIDACIONES
// =====================================
const validarValores = ({ nombre, email, empresa, telefono, categoria }) => {
    const errores = {};

    if (!nombre || nombre.trim().length < 2)
        errores.nombre = "El nombre es obligatorio y debe tener al menos 2 letras";

    const expEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email || !expEmail.test(email))
        errores.email = "Email no válido";

    if (!empresa || empresa.trim().length < 2)
        errores.empresa = "La empresa es obligatoria";

    if (telefono) {
        const digits = telefono.replace(/\D/g, "");
        if (digits.length < 7 || digits.length > 15)
            errores.telefono = "Teléfono inválido (7-15 dígitos)";
    }

    if (!categoria)
        errores.categoria = "Selecciona una categoría";

    return errores;
};


// LIMPIAR ERRORES DEL DOM
const clearAllErrors = () => {
    document.querySelectorAll(".text-danger").forEach(e => e.textContent = "");
    document.querySelectorAll("input, select").forEach(i => i.classList.remove("is-invalid"));
};

const applyErrorsToDOM = (errores) => {
    for (const campo in errores) {
        const span = document.getElementById(campo + "Error");
        if (span) span.textContent = errores[campo];

        const input = document.getElementById(campo);
        if (input) input.classList.add("is-invalid");
    }
};


// =====================================
// RENDER EN TABLA
// =====================================
const renderClientes = (lista) => {
    const cont = document.getElementById("clientesList");

    if (!lista || lista.length === 0) {
        cont.innerHTML = `<p>No hay clientes registrados</p>`;
        return;
    }

    cont.innerHTML = `
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Teléfono</th>
                        <th>Empresa</th>
                        <th>Categoría</th>
                        <th style="width: 150px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    ${lista.map(c => `
                        <tr>
                            <td>${c.nombre}</td>
                            <td>${c.email}</td>
                            <td>${c.telefono || "—"}</td>
                            <td>${c.empresa}</td>
                            <td>${c.categoria.toUpperCase()}</td>
                            <td class="text-center">
                                <button class="btn btn-warning btn-sm me-2" onclick="editar('${c.id}')">
                                    Editar
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="borrar('${c.id}')">
                                    Eliminar
                                </button>
                            </td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
        </div>
    `;
};


// =====================================
// EDITAR
// =====================================
window.editar = (id) => {
    const c = getClientes().find(x => x.id === id);
    if (!c) return;

    clienteId.value = c.id;
    nombre.value = c.nombre;
    email.value = c.email;
    telefono.value = c.telefono;
    empresa.value = c.empresa;
    categoria.value = c.categoria;

    clearAllErrors();
    guardarBtn.textContent = "Actualizar Cliente";
};


// =====================================
// BORRAR
// =====================================
window.borrar = (id) => {
    if (!confirm("¿Seguro de eliminar?")) return;
    eliminarCliente(id);
    renderClientes(getClientes());
};


// =====================================
// INICIALIZAR
// =====================================
document.addEventListener("DOMContentLoaded", () => {

    const form = document.getElementById("clienteForm");
    renderClientes(getClientes());


    // ENVIAR FORMULARIO
    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const data = {
            id: clienteId.value,
            nombre: nombre.value.trim(),
            email: email.value.trim(),
            telefono: telefono.value.trim(),
            empresa: empresa.value.trim(),
            categoria: categoria.value
        };

        const errores = validarValores(data);

        clearAllErrors();

        if (Object.keys(errores).length > 0) {
            applyErrorsToDOM(errores);
            return;
        }

        guardarCliente(data);
        renderClientes(getClientes());
        form.reset();
        clienteId.value = "";
        guardarBtn.textContent = "Guardar Cliente";
    });


    // CANCELAR
    cancelarBtn.addEventListener("click", () => {
        form.reset();
        clienteId.value = "";
        clearAllErrors();
        guardarBtn.textContent = "Guardar Cliente";
    });


    // LIMPIAR BÚSQUEDA
    limpiarBusquedaBtn.addEventListener("click", () => {
        busqueda.value = "";
        renderClientes(getClientes());
    });


    // BÚSQUEDA EN TIEMPO REAL
    busqueda.addEventListener("input", () => {
        const t = busqueda.value.toLowerCase();
        const filtrados = getClientes().filter(c =>
            c.nombre.toLowerCase().includes(t) ||
            c.email.toLowerCase().includes(t) ||
            c.empresa.toLowerCase().includes(t)
        );
        renderClientes(filtrados);
    });

});
    </script>

</body>
</html>
